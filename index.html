<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="
  Add tests and assertions in-line in examples.">
<title>Add tests and assertions in-line in examples • testex</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Add tests and assertions in-line in examples">
<meta property="og:description" content="
  Add tests and assertions in-line in examples.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">testex</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="testex-test-examples-">
<code>testex</code> <strong><em>test examples</em></strong> <img src="https://user-images.githubusercontent.com/18220321/211960830-8c969bee-8c80-4984-8132-b5993911f179.png" align="right" width="134px"><a class="anchor" aria-label="anchor" href="#testex-test-examples-"></a>
</h1></div>
<p><a href="https://cran.r-project.org/package=testex" class="external-link"><img src="https://img.shields.io/cran/v/testex.svg" alt="CRAN"></a> <a href="https://github.com/dgkf/testex/actions?query=workflow%3AR-CMD-check" class="external-link"><img src="https://github.com/dgkf/testex/workflows/R-CMD-check/badge.svg" alt="R CMD check"></a> <a href="https://app.codecov.io/gh/dgkf/testex" class="external-link"><img src="https://img.shields.io/codecov/c/github/dgkf/testex/main.svg" alt="coverage"></a></p>
<p>Add tests and assertions in-line in examples</p>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="section level3">
<h3 id="id_1-add-some-tests">1. Add some tests!<a class="anchor" aria-label="anchor" href="#id_1-add-some-tests"></a>
</h3>
<p>Adding tests right next to your examples using the <code>roxygen2</code> <code>@test</code> tag.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Hello, World!</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' hello("World")</span></span>
<span><span class="co">#' @test "Hello, World!"</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' hello("darkness my old friend")</span></span>
<span><span class="co">#' @test grepl("darkness", .)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">hello</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">who</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello, "</span>, <span class="va">who</span>, <span class="st">"!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_2-add-the-roxygen2-tags">2. Add the <code>roxygen2</code> tags<a class="anchor" aria-label="anchor" href="#id_2-add-the-roxygen2-tags"></a>
</h3>
<p>To enable the new <code>roxygen2</code> tags, you’ll also need to modify your package’s <code>DESCRIPTION</code>. Adding it is as easy as calling:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testex</span><span class="fu">::</span><span class="fu"><a href="reference/use_testex.html">use_testex</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will take a few steps to set up your package:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked>Adds <code>packages = "testex"</code> to the <code>Roxygen</code> field in <code>DESCRIPTION</code></label></li>
<li><label><input type="checkbox" checked>Adds <code>testex</code> as a <code>Suggests</code> dependency</label></li>
<li><label><input type="checkbox" checked>Adds settings to the <code>Config/testex/options</code> field in <code>DESCRIPTION</code></label></li>
<li><label><input type="checkbox" checked>Adds a <code>test-testex.R</code> test file if you’re using <code>testthat</code></label></li>
</ul>
</div>
<div class="section level3">
<h3 id="id_3-configure-how-you-want-to-run-your-tests">3. Configure how you want to run your tests<a class="anchor" aria-label="anchor" href="#id_3-configure-how-you-want-to-run-your-tests"></a>
</h3>
<p>Alternatively, you can configure how <code>testex</code> works yourself.</p>
<div class="section level4">
<h4 id="running-tests-with-testthat">Running tests with <code>testthat</code>
<a class="anchor" aria-label="anchor" href="#running-tests-with-testthat"></a>
</h4>
<p>If you’d like to automatically test your examples when you test your package, <code>testex</code> can generate tests for you that will automatically contribute to <code>testthat</code> results. Simply run:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testex</span><span class="fu">::</span><span class="fu"><a href="reference/use_testex_as_testthat.html">use_testex_as_testthat</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will add a <code>tests/testthat/test-testex.R</code> file to your <code>testthat</code> directory which will re-build and run <code>testthat</code> tests based on examples each time you run your testing suite. Tests are created, expecting that examples execute successfully and that each example test is fulfilled.</p>
</div>
<div class="section level4">
<h4 id="disabling-example-checks-during-r-cmd-check">Disabling example checks during <code>R CMD check</code>
<a class="anchor" aria-label="anchor" href="#disabling-example-checks-during-r-cmd-check"></a>
</h4>
<p>By default, your tests will run when your run examples using <code>R CMD check</code>. However, <code>R CMD check</code> will stop on the first error and truncates error output, which can be inconvenient for debugging. If you’d prefer not to run tests during checking, you can add the following line to your <code>DESCRIPTION</code>.</p>
<pre><code><span><span class="va">Config</span><span class="op">/</span><span class="va">testex</span><span class="op">/</span><span class="va">options</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>check <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="goals">Goals<a class="anchor" aria-label="anchor" href="#goals"></a>
</h2>
<p>R offers some pretty outstanding tools for presenting example code alongside a package. <code>testex</code> aims to make it a bit more powerful by giving you a convenient shorthand for writing tests and easier ability to customize how they are executed.</p>
<ul>
<li><p>Example tests that integrate nicely with popular tools. For those that like to write Rd files by hand and those that like to generate documentation via <code>roxygen2</code>.</p></li>
<li><p>Choose where and how your examples are tested - whether you prefer to test through <code>R CMD check</code> or other mechanisms.</p></li>
</ul>
<div class="section level3">
<h3 id="use-cases">Use Cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h3>
<p>Since R packages may mix and match tools (<code>roxygen2</code>, <code>testthat</code>, etc.) to suit their development needs, a mechanism of testing examples should also be flexible enough to accommodate any development style. Priority workflows include</p>
<ul>
<li><p>Handwritten Rd documentation<br>
Probably the least common use-case, but a priority none-the-less since it stress tests the goal of delivering a workflow-agnostic testing pattern.</p></li>
<li><p><code>roxygen2</code>-generated Rd documentation<br>
It’s hard to find a recent package that doesn’t use <code>roxygen2</code> for generating documentation. As such, any tools should integrate nicely.</p></li>
<li><p><code>testthat</code> testing<br>
Choose whether you want to treat example tests as tests during <code>R CMD check</code>s of examples or during your additional testing steps. Use <code>testthat</code> to execute example tests and integrate the results with your test suite.</p></li>
</ul>
<p>All paths lead back to <code>Rd</code> files as a common ground. Whatever tool you prefer to use, using this central format as the basis for testing means that <code>testex</code> can accommodate your workflow.</p>
</div>
</div>
<div class="section level2">
<h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h2>
<p>Before we jump into what <code>testex</code> offers, let’s take a look at the underlying tools that it builds on top of.</p>
<div class="section level3">
<h3 id="base-building-blocks">Base building-blocks<a class="anchor" aria-label="anchor" href="#base-building-blocks"></a>
</h3>
<p>If you’d like to add testing code to examples in your documentation, you can use the <code>\testonly</code> block to add code which only executes when testing examples. Pretty neat!</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">\examples</span>{</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>identity("hello, world")</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">\testonly</span>{</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  stopifnot(.Last.value == "hello, world")</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>}</span></code></pre></div>
<p>Here we use <code>.Last.value</code> to grab the result of our last example and test it against an expected value. Though, as you might expect, you can’t easily add <em>another</em> test because <code>.Last.value</code> will have changed. This is where <code>testex</code> comes in to help simplify things.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">\examples</span>{</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>identity("hello, world")</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">\testonly</span>{testex::testex(</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  is.character(.),</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  . == "hello, world")</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>)}</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>}</span></code></pre></div>
<p>Already <code>testex</code> is doing a bit of work to make our lives easier. The <code>.Last.value</code> is propagated to each of the tests and we can use the convenient shorthand <code>.</code> to refer to the value we want to test.</p>
</div>
<div class="section level3">
<h3 id="use-a-roxygen2-tag">Use a <code>roxygen2</code> tag!<a class="anchor" aria-label="anchor" href="#use-a-roxygen2-tag"></a>
</h3>
<p>If you’re already using <code>roxygen2</code>, then things get even easier! <code>roxygen2</code> can make use of new tags provided by <code>testex</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Hello, World!</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' hello("World")</span></span>
<span><span class="co">#' @test "Hello, World!"</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' hello("darkness my old friend")</span></span>
<span><span class="co">#' @test grepl("darkness", .)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">hello</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">who</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello, "</span>, <span class="va">who</span>, <span class="st">"!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>After running <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenize()</a></code>, you can take a peak at the <code>Rd</code> files and see how the code has been translated to <code>testex</code> tests.</p>
</div>
<div class="section level3">
<h3 id="leverage-testthat-expectations">Leverage <code>testthat</code> expectations<a class="anchor" aria-label="anchor" href="#leverage-testthat-expectations"></a>
</h3>
<p>A convenience tag is also provide for those that prefer the <code>testthat</code> style of testing. <code>testthat</code> provides a wealth of expectation functions, which can be used in conjunction with <code>testex</code> to write more familiar tests.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Hello, World!</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' hello("World")</span></span>
<span><span class="co">#' @testthat expect_equal("Hello, World!")</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' hello("testthat my old friend")</span></span>
<span><span class="co">#' @testthat expect_match("testthat")</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">hello</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">who</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello, "</span>, <span class="va">who</span>, <span class="st">"!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The <code>@testthat</code> tag will automatically insert the <code>.Last.value</code> from the previous example into the first argument of each expectation. Multiple consecutive <code>@testthat</code> expectations will all test the previous example output.</p>
</div>
</div>
<div class="section level2">
<h2 id="planned-features">Planned Features<a class="anchor" aria-label="anchor" href="#planned-features"></a>
</h2>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<tbody>
<tr class="odd">
<td>Example result propagation using <code><a href="reference/testex.html">testex::testex()</a></code>
</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="even">
<td>
<code>DESCRPTION</code> <code>Config/testex/options</code> to disable execution during <code>R CMD check</code>
</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="odd">
<td>
<code>roxygen2</code> tag <code>@test</code>
</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="even">
<td>
<code>roxygen2</code> tag <code>@testthat</code>
</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="odd">
<td>Aggregation with <code>testthat</code> test results</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="even">
<td>Other ideas? Request a feature!</td>
<td><span class="emoji" data-emoji="thought_balloon">💭</span></td>
</tr>
<tr class="odd">
<td>Have a better name for the package? I’m all ears!</td>
<td><span class="emoji" data-emoji="ear">👂</span></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="prior-art">Prior Art<a class="anchor" aria-label="anchor" href="#prior-art"></a>
</h2>
<p>I stumbled across the awesome <a href="https://github.com/mikldk/roxytest" class="external-link"><code>roxytest</code></a> package when searching around for a solution like this. That package takes a bit of a different approach, embedding test <em>writing</em> alongside examples. The test tags that are offered in that package are used to generate <code>tinytest</code> and <code>testthat</code> tests from in-line tests but otherwise tests are effectively independent from the code that goes on to live in an example.</p>
<p>For me, this didn’t quite solve the problem of ensuring that package examples continue to function as expected. I wanted to explore whether the code in the examples could be tested <em>directly</em> with more extensive integration with the existing <code>examples</code> tools to decouple the testing from <code>roxygen2</code> (or any testing suite) specifically.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing testex</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Doug Kelkhoff <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Doug Kelkhoff.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
