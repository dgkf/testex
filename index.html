<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add tests and assertions in-line in examples • testex</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Add tests and assertions in-line in examples">
<meta property="og:description" content="
  Add tests and assertions in-line in examples.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">testex</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="testex-test-examples">
<code>testex</code> <em><strong>test</strong> <strong>ex</strong>amples</em>
<a class="anchor" aria-label="anchor" href="#testex-test-examples"></a>
</h1></div>

<p>Add tests and assertions in-line in examples</p>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="section level3">
<h3 id="1-add-some-expectations">1. Add some expectations<a class="anchor" aria-label="anchor" href="#1-add-some-expectations"></a>
</h3>
<p>Adding tests right next to your examples using the roxygen <code>@expect</code> tag.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Hello, World!</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' hello("World")</span></span>
<span><span class="co">#' @expect "Hello, World!"</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' hello("darkness my old friend")</span></span>
<span><span class="co">#' @expect grepl("darkness", .)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">hello</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">who</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello, "</span>, <span class="va">who</span>, <span class="st">"!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="2-add-the-roclet">2. Add the <code>roclet</code>
<a class="anchor" aria-label="anchor" href="#2-add-the-roclet"></a>
</h3>
<p>To enable this roclet, you’ll also need to modify your package’s <code>DESCRIPTION</code> to include the <code><a href="reference/rd.html">testex::rd</a></code> roclet. Adding it is as easy as calling:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testex</span><span class="fu">::</span><span class="fu"><a href="reference/use_rd_roclet.html">use_rd_roclet</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will modify your existing roclets, replacing the default <code>roxygen2</code> <code>"rd"</code> roclet with <code>testex</code>’s:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb3-1"><a href="#cb3-1"></a><span class="st">- Roxygen: list(markdown = TRUE, roclets = c("namespace", "rd"))</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="va">+ Roxygen: list(markdown = TRUE, roclets = c("namespace", "testex::rd"))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="3-configure-how-you-want-to-run-your-tests">3. Configure how you want to run your tests<a class="anchor" aria-label="anchor" href="#3-configure-how-you-want-to-run-your-tests"></a>
</h3>
<p>You could call it a day there if you’d like, but there are a few options if you’d like to tune your testing workflow.</p>
<div class="section level4">
<h4 id="running-tests-with-testthat">Running tests with <code>testthat</code>
<a class="anchor" aria-label="anchor" href="#running-tests-with-testthat"></a>
</h4>
<p>If you’d like to automatically test your examples when you test your package, <code>testex</code> can generate tests for you that will automatically contribute to <code>testthat</code> results. Simply run:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testex</span><span class="fu">::</span><span class="fu"><a href="reference/use_testex_as_testthat.html">use_testex_as_testthat</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will add a <code>tests/testthat/test-testex.R</code> file to your <code>testthat</code> directory which will re-build and run testthat tests based on examples each time you run your testing suite. Tests are created to expect that examples execute successfully and that each example expectation is fulfilled.</p>
</div>
<div class="section level4">
<h4 id="disabling-example-checks-during-r-cmd-check">Disabling example checks during <code>R CMD check</code>
<a class="anchor" aria-label="anchor" href="#disabling-example-checks-during-r-cmd-check"></a>
</h4>
<p>By default, your tests will run when your run examples using <code>R CMD check</code>. However, <code>R CMD check</code> will stop on the first error and truncates error output, which can be inconvenient for debugging. If you’d prefer not to run tests during checking, you can add the following line to your <code>DESCRIPTION</code>.</p>
<pre><code><span><span class="va">Config</span><span class="op">/</span><span class="va">testex</span><span class="op">/</span><span class="va">options</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>check <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="goals">Goals<a class="anchor" aria-label="anchor" href="#goals"></a>
</h2>
<p>R offers some pretty outstanding tools for presenting example code alongside a package. <code>testex</code> aims to make it a bit more powerful by giving you a convenient shorthand for writing tests and easier ability to customize how they are executed.</p>
<ul>
<li><p>Example tests that integrate nicely with popular tools. For those that like to write Rd files by hand and those that like to generate documentation via <code>roxygen2</code>.</p></li>
<li><p>Choose where and how your examples are tested - whether you prefer to test through <code>R CMD check</code> or other mechanisms.</p></li>
</ul>
<div class="section level3">
<h3 id="use-cases">Use Cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h3>
<p>Since R packages may mix and match tools (<code>roxygen2</code>, <code>testthat</code>, etc.) to suit their development needs, a mechanism of testing examples should also be flexible enough to accommodate any development style. Priority workflows include</p>
<ul>
<li><p>Handwritten Rd documentation<br>
Probably the least common use-case, but a priority none-the-less since it stress tests the goal of delivering a workflow-agnostic testing pattern.</p></li>
<li><p><code>roxygen2</code>-generated Rd documentation<br>
It’s hard to find a recent package that doesn’t use <code>roxygen2</code> for generating documentation. As such, any tools should integrate nicely.</p></li>
<li><p><code>testthat</code> testing<br>
Choose whether you want to treat example tests as tests during <code>R CMD check</code>s of examples or during your additional testing steps. Use <code>testthat</code> to execute example tests and integrate the results with your test suite.</p></li>
</ul>
<p>All paths lead back to <code>Rd</code> files as a common ground. Whatever tool you prefer to use, using this central format as the basis for testing means that <code>testex</code> can accommodate your workflow.</p>
</div>
</div>
<div class="section level2">
<h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h2>
<p>Before we jump into what <code>testex</code> offers, let’s take a look at the underlying tools that it builds on top of.</p>
<div class="section level3">
<h3 id="base-building-blocks">Base building-blocks<a class="anchor" aria-label="anchor" href="#base-building-blocks"></a>
</h3>
<p>If you’d like to add testing code to examples in your documentation, you can use the <code>\testonly</code> block to add code which only executes when testing examples. Pretty neat!</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">\examples</span>{</span>
<span id="cb6-2"><a href="#cb6-2"></a>identity("hello, world")</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="fu">\testonly</span>{</span>
<span id="cb6-4"><a href="#cb6-4"></a>  stopifnot(.Last.value == "hello, world")</span>
<span id="cb6-5"><a href="#cb6-5"></a>}</span>
<span id="cb6-6"><a href="#cb6-6"></a>}</span></code></pre></div>
<p>Here we use <code>.Last.value</code> to grab the result of our last example and test it against an expected value. Though, as you might expect, you can’t easily add <em>another</em> test because <code>.Last.value</code> will have changed. This is where <code>testex</code> comes in to help simplify things.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">\examples</span>{</span>
<span id="cb7-2"><a href="#cb7-2"></a>identity("hello, world")</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">\testonly</span>{testex::testex(</span>
<span id="cb7-4"><a href="#cb7-4"></a>  is.character(.),</span>
<span id="cb7-5"><a href="#cb7-5"></a>  . == "hello, world")</span>
<span id="cb7-6"><a href="#cb7-6"></a>)}</span>
<span id="cb7-7"><a href="#cb7-7"></a>}</span></code></pre></div>
<p>Already <code>testex</code> is doing a bit of work to make our lives easier. The <code>.Last.value</code> is propegated to each of the tests and we can use the convenient shorthand <code>.</code> to refer to the value we want to test.</p>
</div>
<div class="section level3">
<h3 id="use-a-roclet">Use a <code>roclet</code>!<a class="anchor" aria-label="anchor" href="#use-a-roclet"></a>
</h3>
<p>If you’re already using <code>roxygen2</code>, then things get even easier! You can add in the <code>"testex::rd"</code> roclet (replacing the default <code>roxygen2</code> <code>"rd"</code> roclet) and make use of the <code>@expect</code> tag.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Hello, World!</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' hello("World")</span></span>
<span><span class="co">#' @expect "Hello, World!"</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' hello("darkness my old friend")</span></span>
<span><span class="co">#' @expect grepl("darkness", .)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">hello</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">who</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello, "</span>, <span class="va">who</span>, <span class="st">"!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>After running <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenize()</a></code>, you can take a peak at the <code>Rd</code> files and see how the code has been translated to <code>testex</code> tests.</p>
</div>
<div class="section level3">
<h3 id="leverage-testthat-expectations">Leverage <code>testthat</code> expectations<a class="anchor" aria-label="anchor" href="#leverage-testthat-expectations"></a>
</h3>
<p>A convenience tag is also provide for those that prefer the <code>testthat</code> style of testing. <code>testthat</code> provides a wealth of expectation functions, which can be used in conjunction with <code>testex</code> to write more familiar tests.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Hello, World!</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' hello("World")</span></span>
<span><span class="co">#' @testthat expect_equal("Hello, World!")</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' hello("testthat my old friend")</span></span>
<span><span class="co">#' @testthat expect_match("testthat")</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">hello</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">who</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello, "</span>, <span class="va">who</span>, <span class="st">"!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The <code>@testthat</code> tag will automatically insert the <code>.Last.value</code> from the previous example into the first argument of each expectation. Multiple consecutive <code>@testthat</code> expecations will all test the previous example output.</p>
</div>
</div>
<div class="section level2">
<h2 id="roadmap">Roadmap<a class="anchor" aria-label="anchor" href="#roadmap"></a>
</h2>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<tbody>
<tr class="odd">
<td>Example result propegation using <code><a href="reference/testex.html">testex::testex()</a></code>
</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="even">
<td>
<code>DESCRPTION</code> <code>Config/testex/options</code> to disable execution during <code>R CMD check</code>
</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="odd">
<td>
<code>roxygen2</code> tag <code>@expect</code>
</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="even">
<td>
<code>roxygen2</code> tag <code>@testthat</code>
</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="odd">
<td>Aggregation with <code>testthat</code> test results</td>
<td><span class="emoji" data-emoji="ballot_box_with_check">☑️</span></td>
</tr>
<tr class="even">
<td>Other ideas? Request a feature!</td>
<td><span class="emoji" data-emoji="thought_balloon">💭</span></td>
</tr>
<tr class="odd">
<td>Have a better name for the package? I’m all ears!</td>
<td><span class="emoji" data-emoji="ear">👂</span></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="prior-art">Prior Art<a class="anchor" aria-label="anchor" href="#prior-art"></a>
</h2>
<p>I stumbled across the awesome <a href="https://github.com/mikldk/roxytest" class="external-link"><code>roxytest</code></a> package when searching around for a solution like this. That package takes a bit of a different approach, embedding test <em>writing</em> alongside examples. The test tags that are offered in that package are used to generate <code>tinytest</code> and <code>testthat</code> tests from in-line tests but otherwise tests are effectively independent from the code that goes on to live in an example.</p>
<p>For me, this didn’t quite solve the problem of ensuring that package examples continue to function as expected. I wanted to explore whether the code in the examples could be tested <em>directly</em> with more extensive integration with the existing <code>examples</code> tools to decouple the testing from <code>roxygen2</code> (or any testing suite) specifically.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing testex</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Doug Kelkhoff <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=testex" class="external-link"><img src="https://img.shields.io/cran/v/testex.svg" alt="CRAN"></a></li>
<li><a href="https://github.com/dgkf/testex/actions?query=workflow%3AR-CMD-check" class="external-link"><img src="https://github.com/dgkf/testex/workflows/R-CMD-check/badge.svg" alt="R CMD check"></a></li>
<li><a href="https://app.codecov.io/gh/dgkf/testex" class="external-link"><img src="https://img.shields.io/codecov/c/github/dgkf/testex/main.svg" alt="Codecov"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Doug Kelkhoff.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
